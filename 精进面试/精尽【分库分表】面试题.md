# ç²¾å°½ã€åˆ†åº“åˆ†è¡¨ã€‘é¢è¯•é¢˜



ä»¥ä¸‹é¢è¯•é¢˜ï¼ŒåŸºäºç½‘ç»œæ•´ç†ï¼Œå’Œè‡ªå·±ç¼–è¾‘ã€‚å…·ä½“å‚è€ƒçš„æ–‡ç« ï¼Œä¼šåœ¨æ–‡æœ«ç»™å‡ºæ‰€æœ‰çš„é“¾æ¥ã€‚

å¦‚æœèƒ–å‹æœ‰è‡ªå·±çš„ç–‘é—®ï¼Œæ¬¢è¿åœ¨æ˜Ÿçƒæé—®ï¼Œæˆ‘ä»¬ä¸€èµ·æ•´ç†åŠåŠçš„ã€åˆ†åº“åˆ†è¡¨ã€‘é¢è¯•é¢˜çš„å¤§ä¿å¥ã€‚

è€Œé¢˜ç›®çš„éš¾åº¦ï¼Œè‰¿è‰¿å°½é‡æŒ‰ç…§ä»å®¹æ˜“åˆ°å›°éš¾çš„é¡ºåºï¼Œé€æ­¥ä¸‹å»ã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†åº“åˆ†è¡¨ï¼Ÿ

> å¦‚ä¸‹å†…å®¹ï¼Œå¼•ç”¨è‡ª Sharding Sphere çš„æ–‡æ¡£ï¼Œå†™çš„å¾ˆå¤§æ°”ã€‚
>
> [ã€ŠShardingSphere > æ¦‚å¿µ & åŠŸèƒ½ > æ•°æ®åˆ†ç‰‡ã€‹](http://shardingsphere.io/document/current/cn/features/sharding/)

ä¼ ç»Ÿçš„å°†æ•°æ®é›†ä¸­å­˜å‚¨è‡³å•ä¸€æ•°æ®èŠ‚ç‚¹çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨**æ€§èƒ½ã€å¯ç”¨æ€§å’Œè¿ç»´æˆæœ¬**è¿™ä¸‰æ–¹é¢å·²ç»éš¾äºæ»¡è¶³äº’è”ç½‘çš„æµ·é‡æ•°æ®åœºæ™¯ã€‚

1ï¼‰æ€§èƒ½

ä»æ€§èƒ½æ–¹é¢æ¥è¯´ï¼Œç”±äºå…³ç³»å‹æ•°æ®åº“å¤§å¤šé‡‡ç”¨ B+ æ ‘ç±»å‹çš„ç´¢å¼•ï¼Œåœ¨æ•°æ®é‡è¶…è¿‡é˜ˆå€¼çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•æ·±åº¦çš„å¢åŠ ä¹Ÿå°†ä½¿å¾—ç£ç›˜è®¿é—®çš„ IO æ¬¡æ•°å¢åŠ ï¼Œè¿›è€Œå¯¼è‡´æŸ¥è¯¢æ€§èƒ½çš„ä¸‹é™ã€‚

åŒæ—¶ï¼Œé«˜å¹¶å‘è®¿é—®è¯·æ±‚ä¹Ÿä½¿å¾—é›†ä¸­å¼æ•°æ®åº“æˆä¸ºç³»ç»Ÿçš„æœ€å¤§ç“¶é¢ˆã€‚

2ï¼‰å¯ç”¨æ€§

ä»å¯ç”¨æ€§çš„æ–¹é¢æ¥è®²ï¼ŒæœåŠ¡åŒ–çš„æ— çŠ¶æ€å‹ï¼Œèƒ½å¤Ÿè¾¾åˆ°è¾ƒå°æˆæœ¬çš„éšæ„æ‰©å®¹ï¼Œè¿™å¿…ç„¶å¯¼è‡´ç³»ç»Ÿçš„æœ€ç»ˆå‹åŠ›éƒ½è½åœ¨æ•°æ®åº“ä¹‹ä¸Šã€‚è€Œå•ä¸€çš„æ•°æ®èŠ‚ç‚¹ï¼Œæˆ–è€…ç®€å•çš„ä¸»ä»æ¶æ„ï¼Œå·²ç»è¶Šæ¥è¶Šéš¾ä»¥æ‰¿æ‹…ã€‚æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œå·²æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„å…³é”®ã€‚

3ï¼‰è¿ç»´æˆæœ¬

ä»è¿ç»´æˆæœ¬æ–¹é¢è€ƒè™‘ï¼Œå½“ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸­çš„æ•°æ®è¾¾åˆ°é˜ˆå€¼ä»¥ä¸Šï¼Œå¯¹äº DBA çš„è¿ç»´å‹åŠ›å°±ä¼šå¢å¤§ã€‚æ•°æ®å¤‡ä»½å’Œæ¢å¤çš„æ—¶é—´æˆæœ¬éƒ½å°†éšç€æ•°æ®é‡çš„å¤§å°è€Œæ„ˆå‘ä¸å¯æ§ã€‚ä¸€èˆ¬æ¥è®²ï¼Œå•ä¸€æ•°æ®åº“å®ä¾‹çš„æ•°æ®çš„é˜ˆå€¼åœ¨ 1TB ä¹‹å†…ï¼Œæ˜¯æ¯”è¾ƒåˆç†çš„èŒƒå›´ã€‚

ğŸ¦… **é‚£ä¹ˆä¸ºä»€ä¹ˆä¸é€‰æ‹© NoSQL å‘¢ï¼Ÿ**

åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“æ— æ³•æ»¡è¶³äº’è”ç½‘åœºæ™¯éœ€è¦çš„æƒ…å†µä¸‹ï¼Œå°†æ•°æ®å­˜å‚¨è‡³åŸç”Ÿæ”¯æŒåˆ†å¸ƒå¼çš„ NoSQL çš„å°è¯•è¶Šæ¥è¶Šå¤šã€‚ ä½† NoSQL å¯¹ SQL çš„ä¸å…¼å®¹æ€§ä»¥åŠç”Ÿæ€åœˆçš„ä¸å®Œå–„ï¼Œä½¿å¾—å®ƒä»¬åœ¨ä¸å…³ç³»å‹æ•°æ®åº“çš„åšå¼ˆä¸­å§‹ç»ˆæ— æ³•å®Œæˆè‡´å‘½ä¸€å‡»ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“çš„åœ°ä½å´ä¾ç„¶ä¸å¯æ’¼åŠ¨ã€‚

## ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨ï¼Ÿ

æ•°æ®åˆ†ç‰‡ï¼ŒæŒ‡æŒ‰ç…§æŸä¸ªç»´åº¦å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œ**åˆ†åº“å’Œåˆ†è¡¨**ã€‚

- åˆ†åº“å’Œåˆ†è¡¨å‡å¯ä»¥æœ‰æ•ˆçš„é¿å…ç”±æ•°æ®é‡è¶…è¿‡å¯æ‰¿å—é˜ˆå€¼è€Œäº§ç”Ÿçš„æŸ¥è¯¢ç“¶é¢ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆ†åº“è¿˜èƒ½å¤Ÿç”¨äºæœ‰æ•ˆçš„åˆ†æ•£å¯¹æ•°æ®åº“å•ç‚¹çš„è®¿é—®é‡ã€‚
- åˆ†è¡¨è™½ç„¶æ— æ³•ç¼“è§£æ•°æ®åº“å‹åŠ›ï¼Œä½†å´èƒ½å¤Ÿæä¾›å°½é‡å°†åˆ†å¸ƒå¼äº‹åŠ¡è½¬åŒ–ä¸ºæœ¬åœ°äº‹åŠ¡çš„å¯èƒ½ï¼Œä¸€æ—¦æ¶‰åŠåˆ°è·¨åº“çš„æ›´æ–°æ“ä½œï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¾€å¾€ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚ã€‚
- ä½¿ç”¨å¤šä¸»å¤šä»çš„åˆ†ç‰‡æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å…æ•°æ®å•ç‚¹ï¼Œä»è€Œæå‡æ•°æ®æ¶æ„çš„å¯ç”¨æ€§ã€‚

é€šè¿‡åˆ†åº“å’Œåˆ†è¡¨è¿›è¡Œæ•°æ®çš„æ‹†åˆ†æ¥ä½¿å¾—å„ä¸ªè¡¨çš„æ•°æ®é‡ä¿æŒåœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œä»¥åŠå¯¹æµé‡è¿›è¡Œç–å¯¼åº”å¯¹é«˜è®¿é—®é‡ï¼Œæ˜¯åº”å¯¹é«˜å¹¶å‘å’Œæµ·é‡æ•°æ®ç³»ç»Ÿçš„æœ‰æ•ˆæ‰‹æ®µã€‚æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸ºå‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡ã€‚

ğŸ¦… **å‚ç›´åˆ†ç‰‡**

æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚ åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚

ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨å‚ç›´åˆ†ç‰‡åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆï¼š

![å‚ç›´åˆ†ç‰‡](http://shardingsphere.jd.com/document/current/img/sharding/vertical_sharding.png)

å‚ç›´åˆ†ç‰‡å¾€å¾€éœ€è¦å¯¹æ¶æ„å’Œè®¾è®¡è¿›è¡Œè°ƒæ•´ã€‚é€šå¸¸æ¥è®²ï¼Œæ˜¯æ¥ä¸åŠåº”å¯¹äº’è”ç½‘ä¸šåŠ¡éœ€æ±‚å¿«é€Ÿå˜åŒ–çš„ï¼›è€Œä¸”ï¼Œå®ƒä¹Ÿå¹¶æ— æ³•çœŸæ­£çš„è§£å†³å•ç‚¹ç“¶é¢ˆã€‚ å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚

å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹ï¼š

- åº“è¡¨èŒè´£å•ä¸€ï¼Œå¤æ‚åº¦é™ä½ï¼Œæ˜“äºç»´æŠ¤ã€‚
- å•åº“æˆ–å•è¡¨å‹åŠ›é™ä½ã€‚ ç›¸äº’ä¹‹é—´çš„å½±å“ä¹Ÿä¼šé™ä½ã€‚

å‚ç›´æ‹†åˆ†çš„ç¼ºç‚¹ï¼š

- éƒ¨åˆ†è¡¨å…³è”æ— æ³•åœ¨æ•°æ®åº“çº§åˆ«å®Œæˆï¼Œéœ€è¦åœ¨ç¨‹åºä¸­å®Œæˆã€‚
- å•è¡¨å¤§æ•°æ®é‡ä»ç„¶å­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚
- å•è¡¨æˆ–å•åº“é«˜çƒ­ç‚¹è®¿é—®ä¾æ—§å¯¹ DB å‹åŠ›éå¸¸å¤§ã€‚
- äº‹åŠ¡å¤„ç†ç›¸å¯¹æ›´ä¸ºå¤æ‚ï¼Œéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡çš„ä»‹å…¥ã€‚
- æ‹†åˆ†è¾¾åˆ°ä¸€å®šç¨‹åº¦ä¹‹åï¼Œæ‰©å±•æ€§ä¼šé‡åˆ°é™åˆ¶ã€‚

ğŸ¦… **æ°´å¹³åˆ†ç‰‡**

æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚ ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œå®ƒä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚

ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![æ°´å¹³åˆ†ç‰‡](http://shardingsphere.jd.com/document/current/img/sharding/horizontal_sharding.png)

æ°´å¹³åˆ†ç‰‡ä»ç†è®ºä¸Šçªç ´äº†å•æœºæ•°æ®é‡å¤„ç†çš„ç“¶é¢ˆï¼Œå¹¶ä¸”æ‰©å±•ç›¸å¯¹è‡ªç”±ï¼Œæ˜¯åˆ†åº“åˆ†è¡¨çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆã€‚

æ°´å¹³æ‹†åˆ†çš„ä¼˜ç‚¹ï¼š

- è§£å†³å•è¡¨å•åº“å¤§æ•°æ®é‡å’Œé«˜çƒ­ç‚¹è®¿é—®æ€§èƒ½é‡åˆ°ç“¶é¢ˆçš„é—®é¢˜ã€‚
- åº”ç”¨ç¨‹åºç«¯æ•´ä½“æ¶æ„æ”¹åŠ¨ç›¸å¯¹è¾ƒå°‘ã€‚
- äº‹åŠ¡å¤„ç†ç›¸å¯¹ç®€å•ã€‚
- åªè¦åˆ‡åˆ†è§„åˆ™èƒ½å¤Ÿå®šä¹‰å¥½ï¼ŒåŸºæœ¬ä¸Šè¾ƒéš¾é‡åˆ°æ‰©å±•æ€§é™åˆ¶ã€‚

æ°´å¹³æ‹†åˆ†ç¼ºç‚¹ï¼š

- æ‹†åˆ†è§„åˆ™ç›¸å¯¹æ›´å¤æ‚ï¼Œå¾ˆéš¾æŠ½è±¡å‡ºä¸€ä¸ªèƒ½å¤Ÿæ»¡è¶³æ•´ä¸ªæ•°æ®åº“çš„åˆ‡åˆ†è§„åˆ™ã€‚
- åæœŸæ•°æ®çš„ç»´æŠ¤éš¾åº¦æœ‰æ‰€å¢åŠ ï¼Œäººä¸ºæ‰‹å·¥å®šä½æ•°æ®æ›´å›°éš¾ã€‚
- äº§å“é€»è¾‘å°†å˜å¤æ‚ã€‚æ¯”å¦‚æŒ‰å¹´æ¥è¿›è¡Œå†å²æ•°æ®å½’æ¡£æ‹†åˆ†ï¼Œè¿™ä¸ªæ—¶å€™åœ¨é¡µé¢è®¾è®¡ä¸Šå°±éœ€è¦çº¦æŸç”¨æˆ·å¿…é¡»è¦å…ˆé€‰æ‹©å¹´ï¼Œç„¶åæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢ã€‚

ğŸ¦… **æ€»ç»“ï¼Ÿ**

- æ•°æ®è¡¨å‚ç›´æ‹†åˆ†ï¼šå•è¡¨å¤æ‚åº¦ã€‚
- æ•°æ®åº“å‚ç›´æ‹†åˆ†ï¼šåŠŸèƒ½æ‹†åˆ†ã€‚
- æ°´å¹³æ‹†åˆ†
  - åˆ†è¡¨ï¼šè§£å†³å•è¡¨å¤§æ•°æ®é‡é—®é¢˜ã€‚
  - åˆ†åº“ï¼šä¸ºäº†è§£å†³å•åº“æ€§èƒ½é—®é¢˜ã€‚

## ç”¨äº†åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œæœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿ

è™½ç„¶æ•°æ®åˆ†ç‰‡è§£å†³äº†æ€§èƒ½ã€å¯ç”¨æ€§ä»¥åŠå•ç‚¹å¤‡ä»½æ¢å¤ç­‰é—®é¢˜ï¼Œä½†åˆ†å¸ƒå¼çš„æ¶æ„åœ¨è·å¾—äº†æ”¶ç›Šçš„åŒæ—¶ï¼Œä¹Ÿå¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚

- é¢å¯¹å¦‚æ­¤æ•£ä¹±çš„åˆ†åº“åˆ†è¡¨ä¹‹åçš„æ•°æ®ï¼Œåº”ç”¨å¼€å‘å·¥ç¨‹å¸ˆå’Œæ•°æ®åº“ç®¡ç†å‘˜å¯¹æ•°æ®åº“çš„æ“ä½œå˜å¾—å¼‚å¸¸ç¹é‡å°±æ˜¯å…¶ä¸­çš„é‡è¦æŒ‘æˆ˜ä¹‹ä¸€ã€‚ä»–ä»¬éœ€è¦çŸ¥é“æ•°æ®éœ€è¦ä»å“ªä¸ªå…·ä½“çš„æ•°æ®åº“çš„åˆ†è¡¨ä¸­è·å–ã€‚

- å¦ä¸€ä¸ªæŒ‘æˆ˜åˆ™æ˜¯ï¼Œèƒ½å¤Ÿæ­£ç¡®çš„è¿è¡Œåœ¨å•èŠ‚ç‚¹æ•°æ®åº“ä¸­çš„ SQL ï¼Œåœ¨åˆ†ç‰‡ä¹‹åçš„æ•°æ®åº“ä¸­å¹¶ä¸ä¸€å®šèƒ½å¤Ÿæ­£ç¡®è¿è¡Œã€‚

  - ä¾‹å¦‚ï¼Œåˆ†è¡¨å¯¼è‡´è¡¨åç§°çš„ä¿®æ”¹ï¼Œæˆ–è€…åˆ†é¡µã€æ’åºã€èšåˆåˆ†ç»„ç­‰æ“ä½œçš„ä¸æ­£ç¡®å¤„ç†ã€‚
  - ä¾‹å¦‚ï¼Œè·¨èŠ‚ç‚¹ join çš„é—®é¢˜ã€‚

- **è·¨åº“äº‹åŠ¡**ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„æ•°æ®åº“é›†ç¾¤è¦é¢å¯¹çš„æ£˜æ‰‹äº‹æƒ…ã€‚

  - åˆç†é‡‡ç”¨åˆ†è¡¨ï¼Œå¯ä»¥åœ¨é™ä½å•è¡¨æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨æœ¬åœ°äº‹åŠ¡ï¼Œå–„äºä½¿ç”¨åŒåº“ä¸åŒè¡¨å¯æœ‰æ•ˆé¿å…åˆ†å¸ƒå¼äº‹åŠ¡å¸¦æ¥çš„éº»çƒ¦ã€‚

    > è¦è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œéœ€è¦å°½é‡æŠŠåŒä¸€ç»„æ•°æ®æ”¾åˆ°åŒä¸€ç»„ DB æœåŠ¡å™¨ä¸Šã€‚
    >
    > ä¾‹å¦‚è¯´ï¼Œå°†åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•ä¸»è¡¨ï¼Œå’Œè®¢å•æ˜ç»†è¡¨æ”¾åˆ°åŒä¸€ä¸ªåº“ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºè®¢å•æ—¶ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨ç›¸åŒæœ¬åœ°äº‹åŠ¡ã€‚

  - åœ¨ä¸èƒ½é¿å…è·¨åº“äº‹åŠ¡çš„åœºæ™¯ï¼Œæœ‰äº›ä¸šåŠ¡ä»ç„¶éœ€è¦ä¿æŒäº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚è€ŒåŸºäº XA çš„åˆ†å¸ƒå¼äº‹åŠ¡ç”±äºåœ¨å¹¶å‘åº¦é«˜çš„åœºæ™¯ä¸­æ€§èƒ½æ— æ³•æ»¡è¶³éœ€è¦ï¼Œå¹¶æœªè¢«äº’è”ç½‘å·¨å¤´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œä»–ä»¬å¤§å¤šé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æŸ”æ€§äº‹åŠ¡ä»£æ›¿å¼ºä¸€è‡´äº‹åŠ¡ã€‚

- åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ ID ã€‚

  - åœ¨å•åº“å•è¡¨çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨æ•°æ®åº“è‡ªå¢ç‰¹æ€§æ¥ç”Ÿæˆä¸»é”®IDï¼Œè¿™æ ·ç¡®å®æ¯”è¾ƒç®€å•ã€‚
  - åœ¨åˆ†åº“åˆ†è¡¨çš„ç¯å¢ƒä¸­ï¼Œæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†è¡¨ä¸Šï¼Œä¸èƒ½å†å€ŸåŠ©æ•°æ®åº“è‡ªå¢é•¿ç‰¹æ€§ã€‚éœ€è¦ä½¿ç”¨å…¨å±€å”¯ä¸€ IDï¼Œä¾‹å¦‚ UUIDã€GUIDç­‰ ã€‚

å…³äºè¿™å—ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹ [ã€Šåˆ†åº“åˆ†è¡¨ã€‹](https://www.yuque.com/lexiangqizhong/java/ckt9uw) æ–‡ç« ã€‚

## äº†è§£å’Œä½¿ç”¨è¿‡å“ªäº›åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Ÿ

åœ¨å°†æ•°æ®åº“è¿›è¡Œåˆ†åº“åˆ†è¡¨ä¹‹åï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¼•å…¥åˆ†åº“åˆ†è¡¨çš„ä¸­é—´ä»¶ï¼Œä½¿ä¹‹èƒ½å¤Ÿè¾¾åˆ°å¦‚ä¸‹ç›®æ ‡ã€‚

> å°½é‡é€æ˜åŒ–åˆ†åº“åˆ†è¡¨æ‰€å¸¦æ¥çš„å½±å“ï¼Œè®©ä½¿ç”¨æ–¹å°½é‡åƒä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ä¸€æ ·ä½¿ç”¨æ°´å¹³åˆ†ç‰‡ä¹‹åçš„æ•°æ®åº“é›†ç¾¤ï¼Œè¿™æ˜¯åˆ†åº“åˆ†è¡¨çš„ä¸»è¦è®¾è®¡ç›®æ ‡ã€‚

ğŸ¦… **åˆ†åº“åˆ†è¡¨çš„å®ç°æ–¹å¼ï¼Ÿ**

ç›®å‰ï¼Œå¸‚é¢ä¸Šæä¾›çš„åˆ†åº“åˆ†è¡¨çš„ä¸­é—´ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š

- Client æ¨¡å¼
- Proxy æ¨¡å¼

ğŸ¦… **åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Ÿ**

æ¯”è¾ƒå¸¸è§çš„åŒ…æ‹¬ï¼š

- Cobar
- MyCAT
- Atlas
- TDDL
- Sharding Sphere

1ï¼‰Cobar

é˜¿é‡Œ b2b å›¢é˜Ÿå¼€å‘å’Œå¼€æºçš„ï¼Œå±äº Proxy å±‚æ–¹æ¡ˆã€‚

æ—©äº›å¹´è¿˜å¯ä»¥ç”¨ï¼Œä½†æ˜¯æœ€è¿‘å‡ å¹´éƒ½æ²¡æ›´æ–°äº†ï¼ŒåŸºæœ¬æ²¡å•¥äººç”¨ï¼Œå·®ä¸å¤šç®—æ˜¯è¢«æŠ›å¼ƒçš„çŠ¶æ€å§ã€‚è€Œä¸”ä¸æ”¯æŒè¯»å†™åˆ†ç¦»ã€å­˜å‚¨è¿‡ç¨‹ã€è·¨åº“ join å’Œåˆ†é¡µç­‰æ“ä½œã€‚

2ï¼‰MyCAT

åŸºäº Cobar æ”¹é€ çš„ï¼Œå±äº Proxy å±‚æ–¹æ¡ˆï¼Œæ”¯æŒçš„åŠŸèƒ½éå¸¸å®Œå–„ï¼Œè€Œä¸”ç›®å‰åº”è¯¥æ˜¯éå¸¸ç«çš„è€Œä¸”ä¸æ–­æµè¡Œçš„æ•°æ®åº“ä¸­é—´ä»¶ï¼Œç¤¾åŒºå¾ˆæ´»è·ƒï¼Œä¹Ÿæœ‰ä¸€äº›å…¬å¸å¼€å§‹åœ¨ç”¨äº†ã€‚ä½†æ˜¯ç¡®å®ç›¸æ¯”äº Sharding Sphere æ¥è¯´ï¼Œå¹´è½»ä¸€äº›ï¼Œç»å†çš„é”¤ç‚¼å°‘ä¸€äº›ã€‚

3ï¼‰Atlas

360 å¼€æºçš„ï¼Œå±äº Proxy å±‚æ–¹æ¡ˆï¼Œä»¥å‰æ˜¯æœ‰ä¸€äº›å…¬å¸åœ¨ç”¨çš„ï¼Œä½†æ˜¯ç¡®å®æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜å°±æ˜¯ç¤¾åŒºæœ€æ–°çš„ç»´æŠ¤éƒ½åœ¨ 5 å¹´å‰äº†ã€‚æ‰€ä»¥ï¼Œç°åœ¨ç”¨çš„å…¬å¸åŸºæœ¬ä¹Ÿå¾ˆå°‘äº†ã€‚

4ï¼‰TDDL

æ·˜å®å›¢é˜Ÿå¼€å‘çš„ï¼Œå±äº client å±‚æ–¹æ¡ˆã€‚æ”¯æŒåŸºæœ¬çš„ crud è¯­æ³•å’Œè¯»å†™åˆ†ç¦»ï¼Œä½†ä¸æ”¯æŒ joinã€å¤šè¡¨æŸ¥è¯¢ç­‰è¯­æ³•ã€‚ç›®å‰ä½¿ç”¨çš„ä¹Ÿä¸å¤šï¼Œå› ä¸ºè¿˜ä¾èµ–æ·˜å®çš„ diamond é…ç½®ç®¡ç†ç³»ç»Ÿã€‚

5ï¼‰Sharding Sphere

Sharding Sphere ï¼Œå¯èƒ½æ˜¯ç›®å‰æœ€å¥½çš„å¼€æºçš„åˆ†åº“åˆ†è¡¨è§£å†³æ–¹æ¡ˆï¼Œç›®å‰å·²ç»è¿›å…¥ Apache å­µåŒ–ã€‚

Sharding Sphere æä¾›ä¸‰ç§æ¨¡å¼ï¼š

> å…³äºæ¯ä¸€ç§æ¨¡å¼çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠShardingSphere > æ¦‚è§ˆã€‹](http://shardingsphere.io/document/current/cn/overview/)

- Sharding-JDBC
- Sharding-Proxy
- Sharding-Sidecar è®¡åˆ’å¼€å‘ä¸­ã€‚

å…¶ä¸­ï¼ŒSharding-JDBC å±äº client å±‚æ–¹æ¡ˆï¼Œè¢«å¤§é‡äº’è”ç½‘å…¬å¸æ‰€é‡‡ç”¨ã€‚ä¾‹å¦‚ï¼Œå½“å½“ã€äº¬ä¸œé‡‘èã€ä¸­å›½ç§»åŠ¨ç­‰ç­‰ã€‚

ğŸ¦… **å¦‚ä½•é€‰æ‹©ï¼Ÿ**

ç»¼ä¸Šï¼Œç°åœ¨å…¶å®å»ºè®®è€ƒé‡çš„ï¼Œå°±æ˜¯ Sharding Sphere ï¼Œè¿™ä¸ªå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è¯‰æ±‚ã€‚

Sharding Sphere çš„ Sharding-JDBC æ–¹æ¡ˆï¼Œè¿™ç§ Client å±‚æ–¹æ¡ˆçš„**ä¼˜ç‚¹åœ¨äºä¸ç”¨éƒ¨ç½²ï¼Œè¿ç»´æˆæœ¬ä½ï¼Œä¸éœ€è¦ä»£ç†å±‚çš„äºŒæ¬¡è½¬å‘è¯·æ±‚ï¼Œæ€§èƒ½å¾ˆé«˜**ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°å‡çº§å•¥çš„éœ€è¦å„ä¸ªç³»ç»Ÿéƒ½é‡æ–°å‡çº§ç‰ˆæœ¬å†å‘å¸ƒï¼Œå„ä¸ªç³»ç»Ÿéƒ½éœ€è¦**è€¦åˆ** sharding-jdbc çš„ä¾èµ–ã€‚

> æ®è‰¿è‰¿äº†è§£åˆ°ï¼Œä¾‹å¦‚é˜¿é‡Œã€ç¾å›¢å†…éƒ¨ï¼Œæ›´å¤šä½¿ç”¨çš„æ˜¯ Client æ¨¡å¼ã€‚

Sharding Sphere çš„ Sharding-Proxy æ–¹æ¡ˆï¼Œè¿™ç§ Proxy å±‚æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³æˆ‘ä»¬å¹³æ—¶æŸ¥è¯¢æ•°æ®åº“çš„éœ€æ±‚ã€‚æˆ‘ä»¬åªéœ€è¦è¿æ¥ä¸€ä¸ª Sharding-Proxy ï¼Œå°±å¯ä»¥æŸ¥è¯¢åˆ†åº“åˆ†è¡¨ä¸­çš„æ•°æ®ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è·¨è¯­è¨€çš„éœ€æ±‚ï¼Œä¾‹å¦‚ PHPã€GO ç­‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚

## å¦‚ä½•è¿ç§»åˆ°åˆ†åº“åˆ†è¡¨ï¼Ÿ

ä¸€èˆ¬æ¥è¯´ï¼Œä¼šæœ‰ä¸‰ç§æ–¹å¼ï¼š

- 1ã€åœæ­¢éƒ¨ç½²æ³•ã€‚
- 2ã€åŒå†™éƒ¨ç½²æ³•ï¼ŒåŸºäºä¸šåŠ¡å±‚ã€‚
- 3ã€åŒå†™éƒ¨ç½²æ³•ï¼ŒåŸºäº binlog ã€‚

å…·ä½“çš„è¯¦ç»†æ–¹æ¡ˆï¼Œå¯ä»¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š

- [ã€Šæ•°æ®åº“åˆ†åº“åˆ†è¡¨åï¼Œå¦‚ä½•éƒ¨ç½²ä¸Šçº¿ï¼Ÿã€‹](http://www.iocoder.cn/Fight/After-the-database-sharding-how-to-deploy-online/)
- [ã€Šã€é¢è¯•å®å…¸ã€‘å¦‚ä½•æŠŠå•åº“æ•°æ®è¿ç§»åˆ°åˆ†åº“åˆ†è¡¨ï¼Ÿã€‹](http://www.chaiguanxin.com/articles/2018/11/11/1541923418699.html)
- [ã€Šåˆ†åº“åˆ†è¡¨çš„é¢è¯•é¢˜3ã€‹](https://www.cnblogs.com/daiwei1981/p/9416068.html)

å¦å¤–ï¼Œè¿™æ˜¯å¦å¤–ä¸€ä¸ªæ¯”è¾ƒç›¸å¯¹è¯¦ç»†çš„ã€åŒå†™éƒ¨ç½²æ³•ï¼ŒåŸºäºä¸šåŠ¡å±‚ã€‘çš„è¿‡ç¨‹ï¼š

- åŒå†™ ï¼Œè€åº“ä¸ºä¸»ã€‚è¯»æ“ä½œè¿˜æ˜¯è¯»è€åº“è€è¡¨ï¼Œå†™æ“ä½œæ˜¯åŒå†™åˆ°æ–°è€è¡¨ã€‚
- å†å²æ•°æ®è¿ç§» dts + æ–°æ•°æ®å¯¹è´¦æ ¡éªŒï¼ˆjobï¼‰ + å†å²æ•°æ®æ ¡éªŒã€‚
- åˆ‡è¯»ï¼šè¯»å†™ä»¥æ–°è¡¨ä¸ºä¸»ï¼Œæ–°è¡¨æˆåŠŸå°±æˆåŠŸäº†ã€‚
- è§‚å¯Ÿå‡ å¤©ï¼Œä¸‹æ‰å†™è€åº“æ“ä½œã€‚

å¦å¤–ï¼Œé£å“¥çš„ [ã€Šä¸åœæœºåˆ†åº“åˆ†è¡¨è¿ç§»ã€‹](https://www.jianshu.com/p/223d71421f49) æ–‡ç« ï¼Œä¹Ÿéå¸¸æ¨èçœ‹çœ‹ã€‚

ğŸ¦… **å¦‚ä½•è®¾è®¡å¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Ÿ**

å¯ä»¥å‚çœ‹ [ã€Šå¦‚ä½•è®¾è®¡å¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Ÿã€‹](https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/database-shard-dynamic-expand.md) æ–‡ç« ã€‚ç®€å•çš„ç»“è®ºæ˜¯ï¼š

- æå‰è€ƒè™‘å¥½å®¹é‡çš„è§„åˆ’ï¼Œé¿å…æ‰©å®¹çš„æƒ…å†µã€‚
- å¦‚æœçœŸçš„éœ€è¦æ‰©å®¹ï¼Œèµ°ä¸Šè¿°çš„ [ã€Œå¦‚ä½•è¿ç§»åˆ°åˆ†åº“åˆ†è¡¨ï¼Ÿã€](http://svip.iocoder.cn/database-sharding/Interview/#) æåˆ°çš„æ–¹æ¡ˆã€‚

## ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä¸»é”®ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ

åˆ†å¸ƒå¼ä¸»é”®çš„å®ç°æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šè°ˆè°ˆ IDã€‹](http://www.iocoder.cn/Architecture/talk-about-global-id/) çš„æ€»ç»“ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œç›®å‰é‡‡ç”¨ SnowFlake çš„å±…å¤šï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠSharding-JDBC æºç åˆ†æ â€”â€” åˆ†å¸ƒå¼ä¸»é”®ã€‹](http://www.iocoder.cn/Sharding-JDBC/distributed-id/?vip) çš„æºç çš„å…·ä½“å®ç°ï¼Œæ¯”è¾ƒç®€å•ã€‚

## åˆ†ç‰‡é”®çš„é€‰æ‹©ï¼Ÿ

åˆ†åº“åˆ†è¡¨åï¼Œåˆ†ç‰‡é”®çš„é€‰æ‹©éå¸¸é‡è¦ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š

- ä¿¡æ¯è¡¨ï¼Œä½¿ç”¨ id è¿›è¡Œåˆ†ç‰‡ã€‚ä¾‹å¦‚è¯´ï¼Œæ–‡ç« ã€å•†å“ä¿¡æ¯ç­‰ç­‰ã€‚
- ä¸šåŠ¡è¡¨ï¼Œä½¿ç”¨ user_id è¿›è¡Œåˆ†ç‰‡ã€‚ä¾‹å¦‚è¯´ï¼Œè®¢å•è¡¨ã€æ”¯ä»˜è¡¨ç­‰ç­‰ã€‚
- æ—¥å¿—è¡¨ï¼Œä½¿ç”¨ create_time è¿›è¡Œåˆ†ç‰‡ã€‚ä¾‹å¦‚è¯´ï¼Œè®¿é—®æ—¥å¿—ã€ç™»é™†æ—¥å¿—ç­‰ç­‰ã€‚

ğŸ¦… **åˆ†ç‰‡ç®—æ³•çš„é€‰æ‹©ï¼Ÿ**

é€‰æ‹©å¥½åˆ†ç‰‡é”®ä¹‹åï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ†ç‰‡ç®—æ³•ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§ï¼š

- å–ä½™åˆ†ç‰‡ç®—æ³•ã€‚ä¾‹å¦‚è¯´ï¼Œæœ‰å››ä¸ªåº“ï¼Œé‚£ä¹ˆ user_id ä¸º 10 æ—¶ï¼Œåˆ†åˆ°ç¬¬

   

  ```
  10 % 4 = 2
  ```

   

  ä¸ªåº“ã€‚

  - å½“ç„¶ï¼Œå¦‚æœåˆ†ç‰‡é”®æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™éœ€è¦å…ˆè¿›è¡Œ hash çš„æ–¹å¼ï¼Œè½¬æ¢æˆæ•´å½¢ï¼Œè¿™æ ·æ‰å¯ä»¥å–ä½™ã€‚
  - å½“ç„¶ï¼Œå¦‚æœåˆ†ç‰‡é”®æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ hash çš„æ–¹å¼ã€‚

- èŒƒå›´ç®—æ³•ã€‚

  - ä¾‹å¦‚è¯´ï¼Œæ—¶é—´èŒƒå›´ã€‚

ä¸Šè¿°ä¸¤ç§ç®—æ³•ï¼Œå„æœ‰ä¼˜ç¼ºç‚¹ã€‚

- å¯¹äºå–ä½™æ¥è¯´ï¼š
  - å¥½å¤„ï¼Œå¯ä»¥å¹³å‡åˆ†é…æ¯ä¸ªåº“çš„æ•°æ®é‡å’Œè¯·æ±‚å‹åŠ›ã€‚
  - åå¤„ï¼Œåœ¨äºè¯´æ‰©å®¹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¼šæœ‰ä¸€ä¸ªæ•°æ®è¿ç§»çš„è¿‡ç¨‹ï¼Œä¹‹å‰çš„æ•°æ®éœ€è¦é‡æ–°è®¡ç®— hash å€¼é‡æ–°åˆ†é…åˆ°ä¸åŒçš„åº“æˆ–è¡¨ã€‚
- å¯¹äº range æ¥è¯´ï¼š
  - å¥½å¤„ï¼Œæ‰©å®¹çš„æ—¶å€™å¾ˆç®€å•ï¼Œå› ä¸ºä½ åªè¦é¢„å¤‡å¥½ï¼Œç»™æ¯ä¸ªæœˆéƒ½å‡†å¤‡ä¸€ä¸ªåº“å°±å¯ä»¥äº†ï¼Œåˆ°äº†ä¸€ä¸ªæ–°çš„æœˆä»½çš„æ—¶å€™ï¼Œè‡ªç„¶è€Œç„¶ï¼Œå°±ä¼šå†™æ–°çš„åº“äº†ã€‚
  - ç¼ºç‚¹ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†çš„è¯·æ±‚ï¼Œéƒ½æ˜¯è®¿é—®æœ€æ–°çš„æ•°æ®ã€‚å®é™…ç”Ÿäº§ç”¨ rangeï¼Œè¦çœ‹åœºæ™¯ã€‚

ğŸ¦… **å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸å¸¦åˆ†ç‰‡é”®ï¼Œæ€ä¹ˆåŠï¼Ÿ**

å½“æŸ¥è¯¢ä¸å¸¦åˆ†ç‰‡é”®æ—¶ï¼Œåˆ™ä¸­é—´ä»¶ä¸€èˆ¬ä¼šæ‰«ææ‰€æœ‰åº“è¡¨ï¼Œç„¶åèšåˆç»“æœï¼Œç„¶åè¿›è¡Œè¿”å›ã€‚

å¯¹äºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæ¯ä¸ªåº“è¡¨çš„æŸ¥è¯¢é€Ÿåº¦è¿˜å¯ä»¥ï¼Œè¿”å›ç»“æœçš„é€Ÿåº¦ä¹Ÿæ˜¯ä¸é”™çš„ã€‚å…·ä½“ï¼Œèƒ–å‹å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡è¿›è¡Œæµ‹è¯•ã€‚

ğŸ¦… **ä½¿ç”¨ user_id åˆ†åº“åˆ†è¡¨åï¼Œä½¿ç”¨ id æŸ¥è¯¢æ€ä¹ˆåŠï¼Ÿ**

æœ‰å››ç§æ–¹æ¡ˆã€‚

1ï¼‰ä¸å¤„ç†

æ­£å¦‚åœ¨ [ã€Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸å¸¦åˆ†ç‰‡é”®ï¼Œæ€ä¹ˆåŠï¼Ÿã€](http://svip.iocoder.cn/database-sharding/Interview/#) é—®é¢˜æ‰€è¯´ï¼Œå¦‚æœæ€§èƒ½å¯ä»¥æ¥å—ï¼Œå¯ä»¥ä¸å»å¤„ç†ã€‚å½“ç„¶ï¼Œå‰ææ˜¯è¿™æ ·çš„æŸ¥è¯¢ä¸å¤šï¼Œä¸ä¼šç»™ç³»ç»Ÿå¸¦æ¥è´Ÿæ‹…ã€‚

2ï¼‰æ˜ å°„å…³ç³»

åˆ›å»ºæ˜ å°„è¡¨ï¼Œåªæœ‰ idã€user_id ä¸¤åˆ—å­—æ®µã€‚ä½¿ç”¨ id æŸ¥è¯¢æ—¶ï¼Œå…ˆä»æ˜ å°„è¡¨è·å¾— id å¯¹åº”çš„ user_id ï¼Œç„¶åå†ä½¿ç”¨ id + user_id å»æŸ¥è¯¢å¯¹åº”çš„è¡¨ã€‚

å½“ç„¶ï¼Œéšç€ä¸šåŠ¡é‡çš„å¢é•¿ï¼Œæ˜ å°„è¡¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œåç»­ä¹Ÿå¯èƒ½éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚

å¯¹äºè¿™æ–¹å¼ï¼Œä¹Ÿå¯ä»¥æœ‰ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆã€‚

- æ˜ å°„è¡¨æ”¹æˆç¼“å­˜åˆ° Redis ç­‰ KV ç¼“å­˜ä¸­ã€‚å½“ç„¶ï¼Œéœ€è¦è€ƒè™‘å¦‚æœ Redis æŒä¹…åŒ–çš„æƒ…å†µã€‚
- å°†æ˜ å°„è¡¨ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå‡å°‘ä¸€æ¬¡åˆ°æ˜ å°„è¡¨çš„æŸ¥è¯¢ã€‚

3ï¼‰åŸºå›  id

åˆ†åº“åŸºå› ï¼šå‡å¦‚é€šè¿‡ user_id åˆ†åº“ï¼Œåˆ†ä¸º 8 ä¸ªåº“ï¼Œé‡‡ç”¨ user_id % 8 çš„æ–¹å¼è¿›è¡Œè·¯ç”±ï¼Œæ­¤æ—¶æ˜¯ç”± user_id çš„æœ€å 3bit æ¥å†³å®šè¿™è¡Œ User æ•°æ®å…·ä½“è½åˆ°å“ªä¸ªåº“ä¸Šï¼Œé‚£ä¹ˆè¿™ 3bit å¯ä»¥çœ‹ä¸ºåˆ†åº“åŸºå› ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ 3 bit å‚è€ƒç±»ä¼¼ Snowflake çš„æ–¹å¼ï¼Œèå…¥è¿›å…¥åˆ° id ã€‚

> è‰¿è‰¿ï¼šè¿™é‡Œçš„ 3 bit åªæ˜¯ä¸¾ä¾‹å­ï¼Œå®é™…éœ€è¦è€ƒè™‘è‡ªå·±åˆ†å¤šå°‘åº“è¡¨ï¼Œæ¥å†³å®šåˆ°åº•ä½¿ç”¨å¤šå°‘ bit ã€‚

ä¸Šé¢çš„æ˜ å°„å…³ç³»çš„æ–¹æ³•éœ€è¦é¢å¤–å­˜å‚¨æ˜ å°„è¡¨ï¼ŒæŒ‰é user_id å­—æ®µæŸ¥è¯¢æ—¶ï¼Œè¿˜éœ€è¦å¤šä¸€æ¬¡æ•°æ®åº“æˆ– Cache çš„è®¿é—®ã€‚é€šè¿‡åŸºå›  id ï¼Œå°±å¯ä»¥çŸ¥é“æ•°æ®æ‰€åœ¨çš„åº“è¡¨ã€‚

è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šç”¨ uid åˆ†åº“ï¼Œuname ä¸Šçš„æŸ¥è¯¢æ€ä¹ˆåŠï¼Ÿã€‹](http://www.10tiao.com/html/249/201704/2651960032/1.html) æ–‡ç« ã€‚

ç›®å‰ï¼Œå¯ä»¥ä» [ã€Šå¤§ä¼—ç‚¹è¯„è®¢å•ç³»ç»Ÿåˆ†åº“åˆ†è¡¨å®è·µã€‹](https://tech.meituan.com/dianping_order_db_sharding.html) æ–‡ç« ä¸­ï¼Œçœ‹åˆ°å¤§ä¼—ç‚¹è¯„è®¢å•ä½¿ç”¨äº†åŸºå›  id ã€‚

4ï¼‰å¤š sharding column

å…·ä½“çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ [ã€Šåˆ†åº“åˆ†è¡¨çš„æ­£ç¡®å§¿åŠ¿ï¼Œä½  GET åˆ°äº†ä¹ˆï¼Ÿã€‹](https://yq.aliyun.com/articles/641529) ã€‚å½“ç„¶ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯æ¯”è¾ƒå¤æ‚çš„æ–¹æ¡ˆã€‚

## å¦‚ä½•è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ

ç›®å‰å¸‚é¢ä¸Šï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è›®å¤šçš„ï¼Œä½†æ˜¯éƒ½æ˜¯åŸºäºä¸€ä¸ªå‰æï¼Œéœ€è¦ä¿è¯æœ¬åœ°äº‹åŠ¡ã€‚**é‚£ä¹ˆï¼Œå°±å¯¹æˆ‘ä»¬åœ¨åˆ†åº“åˆ†è¡¨æ—¶ï¼Œå°±æœ‰ç›¸åº”çš„è¦æ±‚ï¼šæ•°æ®åœ¨åˆ†åº“åˆ†è¡¨æ—¶ï¼Œéœ€è¦ä¿è¯ä¸€ä¸ªé€»è¾‘ä¸­ï¼Œèƒ½å¤Ÿå½¢æˆæœ¬åœ°äº‹åŠ¡**ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåˆ›å»ºè®¢å•æ—¶ï¼Œæˆ‘ä»¬ä¼šæ’å…¥è®¢å•è¡¨å’Œè®¢å•æ˜ç»†è¡¨ï¼Œé‚£ä¹ˆï¼š

- å¦‚æœæˆ‘ä»¬åŸºäºè¿™ä¸¤ä¸ªè¡¨çš„ id è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œå°†ä¼šå¯¼è‡´æ’å…¥çš„è®°å½•è¢«åˆ†åˆ°ä¸åŒçš„åº“è¡¨ä¸­ï¼Œå› ä¸ºåˆ›å»ºä¸‹å•å¯ä»¥è´­ä¹° n ä¸ªå•†å“ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ 1 æ¡è®¢å•è®°å½•å’Œ n æ¡ è®¢å•æ˜ç»†è®°å½•ã€‚è€Œè¿™ n æ¡è®¢å•æ˜ç»†è®°å½•æ— æ³•å’Œ 1 æ¡è®¢å•è®°å½•åˆ†åˆ°ä¸€ä¸ªåº“è¡¨ä¸­ã€‚

- å¦‚æœæˆ‘ä»¬åŸºäºè¿™ä¸¤ä¸ªè¡¨çš„ user_id è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œé‚£ä¹ˆæ’å…¥çš„è®°å½•è¢«åˆ†åˆ°ç›¸åŒçš„åº“è¡¨ä¸­ã€‚

  > è‰¿è‰¿ï¼šè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸šåŠ¡è¡¨ä¸€èˆ¬ä½¿ç”¨ user_id è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„åŸå› ä¹‹ä¸€ã€‚

å¯èƒ½ä¼šæœ‰èƒ–å‹æœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦å½¢æˆæœ¬åœ°äº‹åŠ¡ï¼Ÿåœ¨æœ‰äº†æœ¬åœ°äº‹åŠ¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼Œåè°ƒå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå½¢æˆæœ€ç»ˆä¸€è‡´æ€§ã€‚å¦å¤–ï¼ŒğŸ˜ˆ æœ¬åœ°äº‹åŠ¡åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿä¿è¯ä¸‡ä¸€æ‰§è¡Œå¤±è´¥ï¼Œå†é‡è¯•æ—¶ï¼Œä¸ä¼šäº§ç”Ÿè„æ•°æ®ã€‚

## å½©è›‹

å‚è€ƒä¸æ¨èå¦‚ä¸‹æ–‡ç« ï¼š

- [ã€ŠSharding Sphere å®˜æ–¹æ–‡æ¡£ã€‹](http://shardingsphere.io/document/current/cn/overview/)
- boothsun [ã€Šåˆ†åº“åˆ†è¡¨é¢è¯•å‡†å¤‡ã€‹](https://www.zybuluo.com/boothsun/note/1107670)
- butterfly100 [ã€Šæ•°æ®åº“åˆ†åº“åˆ†è¡¨æ€è·¯ã€‹](https://www.cnblogs.com/butterfly100/p/9034281.html)



- [é¢è¯•é¢˜](javascript:void(0))







1. [ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†åº“åˆ†è¡¨ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%EF%BC%9F)
2. [ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%EF%BC%9F)
3. [ç”¨äº†åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œæœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E7%94%A8%E4%BA%86%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%EF%BC%9F)
4. [äº†è§£å’Œä½¿ç”¨è¿‡å“ªäº›åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%9F)
5. [å¦‚ä½•è¿ç§»åˆ°åˆ†åº“åˆ†è¡¨ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E5%A6%82%E4%BD%95%E8%BF%81%E7%A7%BB%E5%88%B0%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%EF%BC%9F)
6. [ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä¸»é”®ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%EF%BC%9F%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%EF%BC%9F)
7. [åˆ†ç‰‡é”®çš„é€‰æ‹©ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E5%88%86%E7%89%87%E9%94%AE%E7%9A%84%E9%80%89%E6%8B%A9%EF%BC%9F)
8. [å¦‚ä½•è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ](http://svip.iocoder.cn/database-sharding/Interview/#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%9F)
9. [å½©è›‹](http://svip.iocoder.cn/database-sharding/Interview/#%E5%BD%A9%E8%9B%8B)

Â© 2019 èŠ‹é“æºç 

[Hexo](http://hexo.io/) Theme [Yilia](https://github.com/litten/hexo-theme-yilia) by Litten

æ€»è®¿å®¢æ•° 88012 æ¬¡

 

&&

 

æ€»è®¿é—®é‡ 575428 æ¬¡


  